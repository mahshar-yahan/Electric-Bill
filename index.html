<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electricity Bill Calculator</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- html2pdf library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #2193b0 0%, #6dd5ed 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .calculator-container {
            max-width: 900px;
            margin: 30px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .form-section {
            padding: 30px;
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #667eea;
            margin-top: 20px;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .bill-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            margin-top: 30px;
            border-radius: 15px;
        }
        
        .bill-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }
        
        .bill-total {
            font-size: 1.5rem;
            font-weight: bold;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid white;
        }
        
        .btn-calculate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 40px;
            font-size: 1.1rem;
            border-radius: 10px;
            color: white;
            transition: transform 0.2s;
        }
        
        .btn-calculate:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        
        .add-more-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .appliance-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .pulse-btn {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* PDF styling - HIDDEN FROM VIEW BUT ACCESSIBLE TO html2pdf */
        #billPDF {
            position: absolute;
            left: -10000px;
            background: white;
            padding: 40px;
            width: 210mm;
            font-size: 12pt;
            line-height: 1.5;
            color: #333;
        }
        
        .pdf-header {
            text-align: center;
            border-bottom: 3px solid #667eea;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .pdf-header h2 {
            color: #667eea;
            margin: 0;
            font-size: 24pt;
        }
        
        .pdf-header p {
            margin: 5px 0 0 0;
            color: #666;
            font-size: 10pt;
        }
        
        .pdf-section {
            margin-bottom: 25px;
            page-break-inside: avoid;
        }
        
        .pdf-section h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 14pt;
            font-weight: bold;
        }
        
        .pdf-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .pdf-total {
            font-weight: bold;
            font-size: 16pt;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #333;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="calculator-container">
        <!-- Header -->
        <div class="header-section">
            <h1>‚ö° Electricity Bill Calculator</h1>
            <p class="mb-0">Calculate your monthly electricity consumption with dynamic appliance management</p>
        </div>
        
        <!-- Form Section -->
        <div class="form-section">
            <form id="billForm">
                <!-- Customer Details -->
                <div class="section-title">üìã Customer Details</div>
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Customer Name</label>
                        <input type="text" class="form-control" id="customerName" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Home ID</label>
                        <input type="number" class="form-control" id="homeID" required>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="form-label">Connection Type</label>
                    <select class="form-select" id="connectionType" required>
                        <option value="">Select Type</option>
                        <option value="H">Household (7 tk/unit)</option>
                        <option value="C">Commercial (10 tk/unit)</option>
                    </select>
                </div>
                
                <!-- Appliance Details -->
                <div class="section-title">üîå Appliance Details</div>
                <div class="row g-3 mb-3">
                    <div class="col-md-4">
                        <label class="form-label"><span class="appliance-icon">üåÄ</span>Number of Fans</label>
                        <input type="number" class="form-control" id="numFans" min="0" value="0" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label"><span class="appliance-icon">üí°</span>Number of Lights</label>
                        <input type="number" class="form-control" id="numLights" min="0" value="0" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label"><span class="appliance-icon">üñ•Ô∏è</span>Number of Machines</label>
                        <input type="number" class="form-control" id="numMachines" min="0" value="0" required>
                    </div>
                </div>
                
                <!-- Usage Hours -->
                <div class="section-title">‚è∞ Average Daily Usage Hours</div>
                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <label class="form-label">Fans (hours/day)</label>
                        <input type="number" step="0.1" class="form-control" id="hoursFan" min="0" max="24" value="0" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Lights (hours/day)</label>
                        <input type="number" step="0.1" class="form-control" id="hoursLight" min="0" max="24" value="0" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Machines (hours/day)</label>
                        <input type="number" step="0.1" class="form-control" id="hoursMachine" min="0" max="24" value="0" required>
                    </div>
                </div>
                
                <!-- Info Box -->
                <div class="alert alert-info">
                    <strong>Power Ratings:</strong> Fans: 75W | Lights: 20W | Machines: 200W<br>
                    <strong>Fixed Charges:</strong> Meter Charge: 50 Taka
                </div>
                
                <div class="text-center">
                    <button type="submit" class="btn btn-calculate">Calculate Bill</button>
                    <button type="button" class="btn btn-outline-secondary ms-2" onclick="resetForm()">Reset</button>
                </div>
            </form>
            
            <!-- Bill Display -->
            <div id="billDisplay" style="display: none;">
                <div class="bill-display">
                    <h3 class="text-center mb-4">üìÑ ELECTRIC BILL</h3>
                    
                    <div class="bill-row">
                        <span>Customer Name:</span>
                        <strong id="displayName"></strong>
                    </div>
                    <div class="bill-row">
                        <span>Home ID:</span>
                        <strong id="displayHomeID"></strong>
                    </div>
                    <div class="bill-row">
                        <span>Connection Type:</span>
                        <strong id="displayType"></strong>
                    </div>
                    
                    <div class="mt-4 mb-2"><strong>Current Appliances:</strong></div>
                    <div class="bill-row">
                        <span>üåÄ Total Fans:</span>
                        <strong id="totalFans">0</strong>
                    </div>
                    <div class="bill-row">
                        <span>üí° Total Lights:</span>
                        <strong id="totalLights">0</strong>
                    </div>
                    <div class="bill-row">
                        <span>üñ•Ô∏è Total Machines:</span>
                        <strong id="totalMachines">0</strong>
                    </div>
                    
                    <div class="mt-4 mb-2"><strong>Bill Details:</strong></div>
                    <div class="bill-row">
                        <span>Total Units (30 days):</span>
                        <strong id="totalUnits">0</strong>
                    </div>
                    <div class="bill-row">
                        <span>Energy Charge:</span>
                        <strong id="energyCharge">0</strong>
                    </div>
                    <div class="bill-row">
                        <span>Meter Charge:</span>
                        <strong>50.00 Taka</strong>
                    </div>
                    
                    <div class="bill-total">
                        <div class="bill-row">
                            <span>TOTAL BILL AMOUNT:</span>
                            <strong id="totalBill">0</strong>
                        </div>
                    </div>
                </div>
                
                <!-- Add More Appliances Section -->
                <div class="add-more-section">
                    <h5 class="text-center mb-3">Do you want to add more appliances?</h5>
                    <div class="text-center">
                        <button class="btn btn-success btn-lg pulse-btn" onclick="showAddMore()">
                            ‚ûï Add More Appliances
                        </button>
                        <button class="btn btn-outline-primary btn-lg ms-2" onclick="finalizeBill()">
                            ‚úÖ Finalize Bill
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Add More Form -->
            <div id="addMoreForm" style="display: none;">
                <div class="section-title">‚ûï Add More Appliances</div>
                
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label class="form-label"><span class="appliance-icon">üåÄ</span>Fans to Add</label>
                        <input type="number" class="form-control" id="addFans" min="0" value="0">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Hours/day for new Fans</label>
                        <input type="number" step="0.1" class="form-control" id="addHoursFan" min="0" max="24" value="0">
                    </div>
                </div>
                
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label class="form-label"><span class="appliance-icon">üí°</span>Lights to Add</label>
                        <input type="number" class="form-control" id="addLights" min="0" value="0">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Hours/day for new Lights</label>
                        <input type="number" step="0.1" class="form-control" id="addHoursLight" min="0" max="24" value="0">
                    </div>
                </div>
                
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label class="form-label"><span class="appliance-icon">üñ•Ô∏è</span>Machines to Add</label>
                        <input type="number" class="form-control" id="addMachines" min="0" value="0">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Hours/day for new Machines</label>
                        <input type="number" step="0.1" class="form-control" id="addHoursMachine" min="0" max="24" value="0">
                    </div>
                </div>
                
                <div class="text-center">
                    <button class="btn btn-primary btn-lg" onclick="updateBill()">Update Bill</button>
                    <button class="btn btn-outline-secondary ms-2" onclick="cancelAddMore()">Cancel</button>
                </div>
            </div>
            
            <!-- Final Bill with Download Option -->
            <div id="finalBill" style="display: none;">
                <div class="alert alert-success text-center">
                    <h4>‚úÖ Bill Finalized!</h4>
                    <p class="mb-0">Thank you for using our electricity bill calculator.</p>
                </div>
                
                <div class="text-center mt-4">
                    <button class="btn btn-danger btn-lg" onclick="downloadPDF()">
                        üì• Download PDF
                    </button>
                    <button class="btn btn-outline-primary btn-lg ms-2" onclick="resetForm()">
                        üîÑ New Bill
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- HIDDEN PDF TEMPLATE - NOT DISPLAYED ON PAGE BUT USED FOR PDF GENERATION -->
<div id="billPDF">
    <div class="pdf-header">
        <h2>‚ö° ELECTRICITY BILL</h2>
        <p>Generated on: <span id="pdfDate"></span></p>
    </div>
    
    <div class="pdf-section">
        <h4>Customer Information</h4>
        <div class="pdf-row">
            <span><strong>Customer Name:</strong></span>
            <span id="pdfName"></span>
        </div>
        <div class="pdf-row">
            <span><strong>Home ID:</strong></span>
            <span id="pdfHomeID"></span>
        </div>
        <div class="pdf-row">
            <span><strong>Connection Type:</strong></span>
            <span id="pdfType"></span>
        </div>
    </div>
    
    <div class="pdf-section">
        <h4>Current Appliances</h4>
        <div class="pdf-row">
            <span><strong>Total Fans:</strong></span>
            <span id="pdfFans"></span>
        </div>
        <div class="pdf-row">
            <span><strong>Total Lights:</strong></span>
            <span id="pdfLights"></span>
        </div>
        <div class="pdf-row">
            <span><strong>Total Machines:</strong></span>
            <span id="pdfMachines"></span>
        </div>
    </div>
    
    <div class="pdf-section">
        <h4>Bill Details</h4>
        <div class="pdf-row">
            <span><strong>Total Units (30 days):</strong></span>
            <span id="pdfUnits"></span>
        </div>
        <div class="pdf-row">
            <span><strong>Energy Charge:</strong></span>
            <span id="pdfEnergy"></span>
        </div>
        <div class="pdf-row">
            <span><strong>Meter Charge:</strong></span>
            <span>50.00 Taka</span>
        </div>
        <div class="pdf-row pdf-total">
            <span><strong>TOTAL BILL AMOUNT:</strong></span>
            <span id="pdfTotal"></span>
        </div>
    </div>
</div>

<script>
    // Constants
    const WATT_FAN = 75;
    const WATT_LIGHT = 20;
    const WATT_MACHINE = 200;
    const METER_CHARGE = 50;
    const RATE_HOUSEHOLD = 7;
    const RATE_COMMERCIAL = 10;
    
    // Global state
    let state = {
        name: '',
        homeID: '',
        type: '',
        rate: 0,
        fans: 0,
        lights: 0,
        machines: 0,
        hoursFan: 0,
        hoursLight: 0,
        hoursMachine: 0,
        totalUnits: 0,
        energyBill: 0,
        totalBill: 0
    };
    
    document.getElementById('billForm').addEventListener('submit', function(e) {
        e.preventDefault();
        calculateBill();
    });
    
    function calculateBill() {
        state.name = document.getElementById('customerName').value;
        state.homeID = document.getElementById('homeID').value;
        state.type = document.getElementById('connectionType').value;
        
        state.fans = parseInt(document.getElementById('numFans').value);
        state.lights = parseInt(document.getElementById('numLights').value);
        state.machines = parseInt(document.getElementById('numMachines').value);
        
        state.hoursFan = parseFloat(document.getElementById('hoursFan').value);
        state.hoursLight = parseFloat(document.getElementById('hoursLight').value);
        state.hoursMachine = parseFloat(document.getElementById('hoursMachine').value);
        
        state.rate = (state.type === 'H') ? RATE_HOUSEHOLD : RATE_COMMERCIAL;
        
        displayBill();
    }
    
    function displayBill() {
        const fanConsumption = (state.fans * WATT_FAN * state.hoursFan) / 1000.0;
        const lightConsumption = (state.lights * WATT_LIGHT * state.hoursLight) / 1000.0;
        const machineConsumption = (state.machines * WATT_MACHINE * state.hoursMachine) / 1000.0;
        
        const unitsPerDay = fanConsumption + lightConsumption + machineConsumption;
        state.totalUnits = unitsPerDay * 30;
        
        state.energyBill = state.totalUnits * state.rate;
        state.totalBill = state.energyBill + METER_CHARGE;
        
        const typeText = (state.type === 'H') ? 'Household (7 tk/unit)' : 'Commercial (10 tk/unit)';
        
        // Display on screen
        document.getElementById('displayName').textContent = state.name;
        document.getElementById('displayHomeID').textContent = state.homeID;
        document.getElementById('displayType').textContent = typeText;
        
        document.getElementById('totalFans').textContent = state.fans;
        document.getElementById('totalLights').textContent = state.lights;
        document.getElementById('totalMachines').textContent = state.machines;
        
        document.getElementById('totalUnits').textContent = state.totalUnits.toFixed(2) + ' units';
        document.getElementById('energyCharge').textContent = state.energyBill.toFixed(2) + ' Taka';
        document.getElementById('totalBill').textContent = state.totalBill.toFixed(2) + ' Taka';
        
        // Update PDF data
        const today = new Date();
        document.getElementById('pdfDate').textContent = today.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        
        document.getElementById('pdfName').textContent = state.name;
        document.getElementById('pdfHomeID').textContent = state.homeID;
        document.getElementById('pdfType').textContent = typeText;
        document.getElementById('pdfFans').textContent = state.fans;
        document.getElementById('pdfLights').textContent = state.lights;
        document.getElementById('pdfMachines').textContent = state.machines;
        document.getElementById('pdfUnits').textContent = state.totalUnits.toFixed(2) + ' units';
        document.getElementById('pdfEnergy').textContent = state.energyBill.toFixed(2) + ' Taka';
        document.getElementById('pdfTotal').textContent = state.totalBill.toFixed(2) + ' Taka';
        
        document.getElementById('billDisplay').style.display = 'block';
        document.getElementById('addMoreForm').style.display = 'none';
        document.getElementById('finalBill').style.display = 'none';
        
        document.getElementById('billDisplay').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
    
    function showAddMore() {
        document.getElementById('addMoreForm').style.display = 'block';
        document.getElementById('billDisplay').style.display = 'none';
        
        document.getElementById('addFans').value = '0';
        document.getElementById('addLights').value = '0';
        document.getElementById('addMachines').value = '0';
        document.getElementById('addHoursFan').value = '0';
        document.getElementById('addHoursLight').value = '0';
        document.getElementById('addHoursMachine').value = '0';
        
        document.getElementById('addMoreForm').scrollIntoView({ behavior: 'smooth' });
    }
    
    function cancelAddMore() {
        document.getElementById('addMoreForm').style.display = 'none';
        document.getElementById('billDisplay').style.display = 'block';
    }
    
    function updateBill() {
        const addFans = parseInt(document.getElementById('addFans').value);
        const addLights = parseInt(document.getElementById('addLights').value);
        const addMachines = parseInt(document.getElementById('addMachines').value);
        
        const addHoursFan = parseFloat(document.getElementById('addHoursFan').value);
        const addHoursLight = parseFloat(document.getElementById('addHoursLight').value);
        const addHoursMachine = parseFloat(document.getElementById('addHoursMachine').value);
        
        const oldFans = state.fans;
        const oldLights = state.lights;
        const oldMachines = state.machines;
        
        state.fans += addFans;
        state.lights += addLights;
        state.machines += addMachines;
        
        if (state.fans > 0) {
            state.hoursFan = ((state.hoursFan * oldFans) + (addHoursFan * addFans)) / state.fans;
        }
        if (state.lights > 0) {
            state.hoursLight = ((state.hoursLight * oldLights) + (addHoursLight * addLights)) / state.lights;
        }
        if (state.machines > 0) {
            state.hoursMachine = ((state.hoursMachine * oldMachines) + (addHoursMachine * addMachines)) / state.machines;
        }
        
        displayBill();
    }
    
    function finalizeBill() {
        document.getElementById('billDisplay').style.display = 'none';
        document.getElementById('finalBill').style.display = 'block';
        document.getElementById('finalBill').scrollIntoView({ behavior: 'smooth' });
    }
    
    function downloadPDF() {
        const element = document.getElementById('billPDF');
        const opt = {
            margin: 15,
            filename: `electricity-bill-${state.homeID}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, logging: false },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        
        html2pdf().set(opt).from(element).save();
    }
    
    function resetForm() {
        document.getElementById('billForm').reset();
        document.getElementById('billDisplay').style.display = 'none';
        document.getElementById('addMoreForm').style.display = 'none';
        document.getElementById('finalBill').style.display = 'none';
        
        state = {
            name: '', homeID: '', type: '', rate: 0,
            fans: 0, lights: 0, machines: 0,
            hoursFan: 0, hoursLight: 0, hoursMachine: 0,
            totalUnits: 0, energyBill: 0, totalBill: 0
        };
    }
</script>
</body>
</html>
